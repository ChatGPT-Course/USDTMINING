<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Морской бой</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }

        .container {
            text-align: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .game-boards {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .board {
            border: 2px solid #333;
            padding: 10px;
        }

        .row {
            display: flex;
        }

        .cell {
            width: 30px;
            height: 30px;
            border: 1px solid #ccc;
            cursor: pointer;
        }

        .cell.hit {
            background-color: #ff4444;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }

        button:hover {
            background-color: #45a049;
        }

        button.leave {
            background-color: #f44336;
        }

        button.leave:hover {
            background-color: #d32f2f;
        }

        h1, h2, h3 {
            color: #333;
        }

        .waiting-message {
            color: #666;
            font-style: italic;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="app">
            <h1>Морской бой</h1>
            <div id="lobby">
                <button id="joinButton">Присоединиться к игре</button>
                <p id="playerCount">Игроков в комнате: 0/2</p>
                <p id="waitingMessage" class="waiting-message" style="display: none;">Ожидание второго игрока...</p>
            </div>
            <div id="game" style="display: none;">
                <h2>Игра началась!</h2>
                <div class="game-boards">
                    <div class="board">
                        <h3>Мое поле</h3>
                        <div id="myBoard"></div>
                    </div>
                    <div class="board">
                        <h3>Поле противника</h3>
                        <div id="enemyBoard"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCMos6Y7C-krTLuKCI4VJG-TFLo6QI--k8",
            authDomain: "vrot-x-7a48f.firebaseapp.com",
            databaseURL: "https://vrot-x-7a48f-default-rtdb.firebaseio.com",
            projectId: "vrot-x-7a48f",
            storageBucket: "vrot-x-7a48f.firebasestorage.app",
            messagingSenderId: "622297225288",
            appId: "1:622297225288:web:5df6a5b02ffddedd96e07d"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let roomId = '';
        let players = [];
        let gameStarted = false;
        let myBoard = Array(10).fill().map(() => Array(10).fill(0));
        let enemyBoard = Array(10).fill().map(() => Array(10).fill(0));
        let currentPlayer = null;
        let myPlayerId = null;

        function createBoard(container, board, isEnemy = false) {
            container.innerHTML = '';
            board.forEach((row, i) => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'row';
                row.forEach((cell, j) => {
                    const cellDiv = document.createElement('div');
                    cellDiv.className = `cell ${cell === 1 ? 'hit' : ''}`;
                    if (isEnemy) {
                        cellDiv.addEventListener('click', () => makeMove(i, j));
                    }
                    rowDiv.appendChild(cellDiv);
                });
                container.appendChild(rowDiv);
            });
        }

        function joinRoom() {
            roomId = Math.random().toString(36).substring(7);
            myPlayerId = Math.random().toString(36).substring(7);
            database.ref(`rooms/${roomId}/players/${myPlayerId}`).set({
                id: myPlayerId,
                name: `Player ${players.length + 1}`,
                joinedAt: firebase.database.ServerValue.TIMESTAMP
            });
            
            const joinButton = document.getElementById('joinButton');
            joinButton.textContent = 'Выйти';
            joinButton.classList.add('leave');
            joinButton.onclick = leaveRoom;
            
            document.getElementById('waitingMessage').style.display = 'block';
        }

        function leaveRoom() {
            if (roomId && myPlayerId) {
                database.ref(`rooms/${roomId}/players/${myPlayerId}`).remove();
                roomId = '';
                myPlayerId = null;
                
                const joinButton = document.getElementById('joinButton');
                joinButton.textContent = 'Присоединиться к игре';
                joinButton.classList.remove('leave');
                joinButton.onclick = joinRoom;
                
                document.getElementById('waitingMessage').style.display = 'none';
                document.getElementById('playerCount').textContent = 'Игроков в комнате: 0/2';
            }
        }

        function startGame() {
            if (players.length === 2) {
                database.ref(`rooms/${roomId}`).set({
                    gameStarted: true,
                    currentPlayer: players[0].id,
                    boards: {
                        player1: myBoard,
                        player2: enemyBoard
                    }
                });
            }
        }

        function makeMove(x, y) {
            if (currentPlayer === myPlayerId) {
                enemyBoard[x][y] = 1;
                database.ref(`rooms/${roomId}/boards/player2`).set(enemyBoard);
                database.ref(`rooms/${roomId}/currentPlayer`).set(players.find(p => p.id !== myPlayerId).id);
            }
        }

        // Event Listeners
        document.getElementById('joinButton').addEventListener('click', joinRoom);

        // Firebase listeners
        if (roomId) {
            database.ref(`rooms/${roomId}`).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    players = Object.values(data.players || {});
                    document.getElementById('playerCount').textContent = `Игроков в комнате: ${players.length}/2`;

                    if (data.gameStarted) {
                        document.getElementById('lobby').style.display = 'none';
                        document.getElementById('game').style.display = 'block';
                        myBoard = data.boards?.player1 || Array(10).fill().map(() => Array(10).fill(0));
                        enemyBoard = data.boards?.player2 || Array(10).fill().map(() => Array(10).fill(0));
                        currentPlayer = data.currentPlayer;
                        createBoard(document.getElementById('myBoard'), myBoard);
                        createBoard(document.getElementById('enemyBoard'), enemyBoard, true);
                    }
                }
            });
        }
    </script>
</body>
</html>


