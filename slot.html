<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StarGame - –ò–≥—Ä–∞ –≤ –°–ª–æ—Ç—ã</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #0f0c29;
            color: white;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }
        
        #particles {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        .container {
            position: relative;
            z-index: 1;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            height: auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .profile {
            background: rgba(46, 17, 81, 0.7);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex-grow: 1;
        }
        
        .balance {
            background: rgba(123, 44, 191, 0.3);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }
        
        .balance-item {
            flex: 1;
            text-align: center;
        }
        
        .balance-label {
            font-size: 12px;
            color: #d1d1d1;
            margin-bottom: 5px;
        }
        
        .balance-amount {
            font-size: 22px;
            font-weight: bold;
            color: #f7f7f7;
        }
        
        .slot-machine {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }
        
        .slots-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .slot {
            width: 80px;
            height: 240px;
            overflow: hidden;
            position: relative;
            margin: 0 5px;
            background: rgba(123, 44, 191, 0.2);
            border-radius: 10px;
            border: 2px solid #7b2cbf;
        }
        
        .slot-reel {
            position: absolute;
            width: 100%;
            transition: top 3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        
        .slot-item {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .spin-btn {
            background: linear-gradient(135deg, #7b2cbf 0%, #3a0ca3 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .spin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(123, 44, 191, 0.4);
        }
        
        .spin-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .bet-info {
            margin-top: 10px;
            font-size: 16px;
            color: #d1d1d1;
        }
        
        .win-message {
            font-size: 24px;
            font-weight: bold;
            color: #4caf50;
            margin: 20px 0;
            text-align: center;
            min-height: 30px;
        }
        
        .paytable {
            margin-top: 30px;
            width: 100%;
            background: rgba(46, 17, 81, 0.5);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(123, 44, 191, 0.3);
        }
        
        .paytable-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .paytable-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .paytable-combination {
            display: flex;
            align-items: center;
        }
        
        .paytable-emoji {
            font-size: 20px;
            margin: 0 3px;
        }
        
        .paytable-payout {
            font-weight: bold;
            color: #4caf50;
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 16px;
            color: #b8b8b8;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div id="particles"></div>
    <div class="container">
        <div id="loading" class="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        </div>
        
        <div id="game-content" style="display: none;">
            <button class="back-btn" id="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
            
            <div class="profile">
                <div class="balance floating">
                    <div class="balance-item">
                        <div class="balance-label">–û—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å</div>
                        <div class="balance-amount" id="user-balance">0 ‚≠ê</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-label">–ë–æ–Ω—É—Å–Ω—ã–π –±–∞–ª–∞–Ω—Å</div>
                        <div class="balance-amount" id="user-bonus-balance">0 ‚≠ê</div>
                    </div>
                </div>
                
                <div class="slot-machine">
                    <div class="slots-container" id="slots-container">
                        <div class="slot" id="slot1">
                            <div class="slot-reel" id="reel1"></div>
                        </div>
                        <div class="slot" id="slot2">
                            <div class="slot-reel" id="reel2"></div>
                        </div>
                        <div class="slot" id="slot3">
                            <div class="slot-reel" id="reel3"></div>
                        </div>
                    </div>
                    
                    <div class="win-message" id="win-message"></div>
                    
                    <button class="spin-btn" id="spin-btn">–ö—Ä—É—Ç–∏—Ç—å (5 ‚≠ê)</button>
                    <div class="bet-info">–°—Ç–∞–≤–∫–∞ –±—É–¥–µ—Ç —Å–ø–∏—Å–∞–Ω–∞ —Å –±–æ–Ω—É—Å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞, –ø—Ä–∏ –µ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ - —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ</div>
                </div>
                
                <div class="paytable">
                    <div class="paytable-title">–í—ã–∏–≥—Ä—ã—à–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏</div>
                    <div class="paytable-item">
                        <div class="paytable-combination">
                            <span class="paytable-emoji">üçí</span>
                            <span class="paytable-emoji">üçí</span>
                            <span class="paytable-emoji">üçí</span>
                        </div>
                        <div class="paytable-payout">x5</div>
                    </div>
                    <div class="paytable-item">
                        <div class="paytable-combination">
                            <span class="paytable-emoji">üçã</span>
                            <span class="paytable-emoji">üçã</span>
                            <span class="paytable-emoji">üçã</span>
                        </div>
                        <div class="paytable-payout">x10</div>
                    </div>
                    <div class="paytable-item">
                        <div class="paytable-combination">
                            <span class="paytable-emoji">üçä</span>
                            <span class="paytable-emoji">üçä</span>
                            <span class="paytable-emoji">üçä</span>
                        </div>
                        <div class="paytable-payout">x15</div>
                    </div>
                    <div class="paytable-item">
                        <div class="paytable-combination">
                            <span class="paytable-emoji">üçá</span>
                            <span class="paytable-emoji">üçá</span>
                            <span class="paytable-emoji">üçá</span>
                        </div>
                        <div class="paytable-payout">x20</div>
                    </div>
                    <div class="paytable-item">
                        <div class="paytable-combination">
                            <span class="paytable-emoji">üçâ</span>
                            <span class="paytable-emoji">üçâ</span>
                            <span class="paytable-emoji">üçâ</span>
                        </div>
                        <div class="paytable-payout">x25</div>
                    </div>
                    <div class="paytable-item">
                        <div class="paytable-combination">
                            <span class="paytable-emoji">‚≠ê</span>
                            <span class="paytable-emoji">‚≠ê</span>
                            <span class="paytable-emoji">‚≠ê</span>
                        </div>
                        <div class="paytable-payout">x50</div>
                    </div>
                    <div class="paytable-item">
                        <div class="paytable-combination">
                            <span class="paytable-emoji">7Ô∏è‚É£</span>
                            <span class="paytable-emoji">7Ô∏è‚É£</span>
                            <span class="paytable-emoji">7Ô∏è‚É£</span>
                        </div>
                        <div class="paytable-payout">x100</div>
                    </div>
                    <div class="paytable-item">
                        <div class="paytable-combination">
                            <span class="paytable-emoji">üí∞</span>
                            <span class="paytable-emoji">üí∞</span>
                            <span class="paytable-emoji">üí∞</span>
                        </div>
                        <div class="paytable-payout">x200</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCMos6Y7C-krTLuKCI4VJG-TFLo6QI--k8",
            authDomain: "vrot-x-7a48f.firebaseapp.com",
            databaseURL: "https://vrot-x-7a48f-default-rtdb.firebaseio.com",
            projectId: "vrot-x-7a48f",
            storageBucket: "vrot-x-7a48f.appspot.com",
            messagingSenderId: "622297225288",
            appId: "1:622297225288:web:5df6a5b02ffddedd96e07d"
        };
        
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let currentUserId = null;
        let userBalance = 0;
        let userBonusBalance = 0;
        let isSpinning = false;
        const BET_AMOUNT = 5;
        
        // –°–∏–º–≤–æ–ª—ã –¥–ª—è —Å–ª–æ—Ç–æ–≤
        const SYMBOLS = ['üçí', 'üçã', 'üçä', 'üçá', 'üçâ', '‚≠ê', '7Ô∏è‚É£', 'üí∞'];
        
        // –í—ã–∏–≥—Ä—ã—à–Ω—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
        const PAYOUTS = {
            'üçí': 5,
            'üçã': 10,
            'üçä': 15,
            'üçá': 20,
            'üçâ': 25,
            '‚≠ê': 50,
            '7Ô∏è‚É£': 100,
            'üí∞': 200
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü –Ω–∞ —Ñ–æ–Ω–µ
        function initParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = `${Math.random() * 10 + 5}px`;
                particle.style.height = particle.style.width;
                particle.style.backgroundColor = `rgba(123, 44, 191, ${Math.random() * 0.5 + 0.2})`;
                particle.style.borderRadius = '50%';
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.left = `${Math.random() * 100}%`;
                
                const duration = Math.random() * 30 + 20;
                const delay = Math.random() * 10;
                particle.style.animation = `float ${duration}s ease-in-out ${delay}s infinite`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function initUser() {
            try {
                if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe) {
                    const user = Telegram.WebApp.initDataUnsafe.user;
                    currentUserId = user.id.toString();
                } else {
                    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –Ω–µ –≤ Telegram WebApp
                    currentUserId = new URLSearchParams(window.location.search).get('user_id') || 'test_user';
                }
                
                return currentUserId;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                throw error;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData(userId) {
            try {
                const userRef = database.ref('users/' + userId);
                
                userRef.on('value', (snapshot) => {
                    const userData = snapshot.val();
                    if (userData) {
                        userBalance = userData.balance || 0;
                        userBonusBalance = userData.bonus_balance || 0;
                        
                        document.getElementById('user-balance').textContent = `${userBalance} ‚≠ê`;
                        document.getElementById('user-bonus-balance').textContent = `${userBonusBalance} ‚≠ê`;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏
                        const canSpin = (userBonusBalance + userBalance) >= BET_AMOUNT;
                        document.getElementById('spin-btn').disabled = !canSpin || isSpinning;
                        
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('game-content').style.display = 'block';
                    }
                });
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                throw error;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤
        function initSlots() {
            const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
            
            // –°–æ–∑–¥–∞–µ–º —Å–∏–º–≤–æ–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
            reels.forEach(reel => {
                reel.innerHTML = '';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏
                for (let i = 0; i < 20; i++) {
                    const symbol = document.createElement('div');
                    symbol.className = 'slot-item';
                    symbol.textContent = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                    reel.appendChild(symbol);
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                reel.style.top = '0px';
            });
        }
        
        // –í—Ä–∞—â–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤
        function spinSlots() {
            if (isSpinning) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
            const totalBalance = userBonusBalance + userBalance;
            if (totalBalance < BET_AMOUNT) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å—Ç–∞–≤–∫–∏');
                return;
            }
            
            isSpinning = true;
            document.getElementById('spin-btn').disabled = true;
            document.getElementById('win-message').textContent = '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —Å –∫–∞–∫–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Å–ø–∏—Å—ã–≤–∞—Ç—å
            let useBonusBalance = Math.min(userBonusBalance, BET_AMOUNT);
            let useMainBalance = BET_AMOUNT - useBonusBalance;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
            const updates = {};
            if (useBonusBalance > 0) {
                updates['bonus_balance'] = userBonusBalance - useBonusBalance;
            }
            if (useMainBalance > 0) {
                updates['balance'] = userBalance - useMainBalance;
            }
            
            database.ref('users/' + currentUserId).update(updates);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
            const transactionRef = database.ref('history/' + currentUserId).push();
            transactionRef.set({
                amount: `-${BET_AMOUNT}`,
                description: '–°—Ç–∞–≤–∫–∞ –≤ —Å–ª–æ—Ç–∞—Ö',
                date: new Date().toLocaleString(),
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é (–∏–ª–∏ –Ω–µ—Ç)
            const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
            const results = [];
            let winMultiplier = 0;
            
            // 30% —à–∞–Ω—Å –Ω–∞ –≤—ã–∏–≥—Ä—ã—à
            const willWin = Math.random() < 0.3;
            
            if (willWin) {
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à–Ω—ã–π —Å–∏–º–≤–æ–ª
                const winSymbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                winMultiplier = PAYOUTS[winSymbol];
                results.push(winSymbol, winSymbol, winSymbol);
            } else {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
                for (let i = 0; i < 3; i++) {
                    results.push(SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)]);
                }
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
            reels.forEach((reel, index) => {
                const symbolHeight = 80;
                const spinDuration = 3000;
                const extraSpins = 5 + index; // –ö–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π –±–∞—Ä–∞–±–∞–Ω –¥–µ–ª–∞–µ—Ç –Ω–∞ 1 –æ–±–æ—Ä–æ—Ç –±–æ–ª—å—à–µ
                const targetPosition = -(extraSpins * SYMBOLS.length * symbolHeight) + (SYMBOLS.indexOf(results[index]) * symbolHeight);
                
                reel.style.transition = `top ${spinDuration}ms cubic-bezier(0.25, 0.1, 0.25, 1)`;
                reel.style.top = `${targetPosition}px`;
                
                // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => {
                    reel.style.transition = 'none';
                    const currentTop = parseInt(reel.style.top);
                    reel.style.top = `${currentTop % (SYMBOLS.length * symbolHeight)}px`;
                    
                    // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã –≤–Ω–∏–∑—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤–≤–µ—Ä—Ö—É
                    if (index === 2) { // –ü–æ—Å–ª–µ–¥–Ω–∏–π –±–∞—Ä–∞–±–∞–Ω
                        setTimeout(() => {
                            checkWin(results);
                            isSpinning = false;
                            
                            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞
                            const canSpin = (userBonusBalance + userBalance - BET_AMOUNT) >= BET_AMOUNT;
                            document.getElementById('spin-btn').disabled = !canSpin;
                        }, 500);
                    }
                }, spinDuration);
            });
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–∞
        function checkWin(results) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤—ã–∏–≥—Ä—ã—à–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
            if (results[0] === results[1] && results[1] === results[2]) {
                const winAmount = BET_AMOUNT * PAYOUTS[results[0]];
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–∏–≥—Ä—ã—à–µ
                document.getElementById('win-message').textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount} ‚≠ê`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                database.ref('users/' + currentUserId).transaction((user) => {
                    if (user) {
                        user.balance = (user.balance || 0) + winAmount;
                    }
                    return user;
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
                const transactionRef = database.ref('history/' + currentUserId).push();
                transactionRef.set({
                    amount: `+${winAmount}`,
                    description: `–í—ã–∏–≥—Ä—ã—à –≤ —Å–ª–æ—Ç–∞—Ö (${results[0]} x${PAYOUTS[results[0]]})`,
                    date: new Date().toLocaleString(),
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            document.getElementById('spin-btn').addEventListener('click', spinSlots);
            
            document.getElementById('back-btn').addEventListener('click', () => {
                window.location.href = `index1.html?user_id=${currentUserId}`;
            });
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        async function initApp() {
            initParticles();
            initSlots();
            
            try {
                const userId = await initUser();
                await loadUserData(userId);
                setupEventListeners();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
