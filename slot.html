<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ª–æ—Ç—ã - StarGame</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #0f0c29;
            color: white;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .balance {
            background: rgba(123, 44, 191, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .info-btn {
            background: none;
            border: none;
            color: #00b4db;
            font-size: 20px;
            cursor: pointer;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 1px solid #00b4db;
        }
        
        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .slots-machine {
            width: 100%;
            max-width: 400px;
            background: linear-gradient(135deg, #1a0a2e 0%, #3a0ca3 100%);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(123, 44, 191, 0.5);
            margin-bottom: 20px;
        }
        
        .slots-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
        }
        
        .slot {
            width: 80px;
            height: 80px;
            font-size: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin: 0 5px;
            overflow: hidden;
            position: relative;
        }
        
        .slot-inner {
            position: absolute;
            width: 100%;
            text-align: center;
            transition: transform 0.1s;
        }
        
        .spin-btn {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .spin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }
        
        .spin-btn:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: rgba(46, 17, 81, 0.9);
            padding: 25px;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #00b4db;
        }
        
        .modal-text {
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-weight: bold;
        }
        
        .modal-btn-confirm {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
            color: white;
        }
        
        .modal-btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .modal-btn-close {
            background: linear-gradient(135deg, #7b2cbf 0%, #3a0ca3 100%);
            color: white;
            width: 100%;
        }
        
        .info-modal-content {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .info-section {
            margin-bottom: 15px;
            text-align: left;
        }
        
        .info-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #00b4db;
        }
        
        .payout-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }
        
        @keyframes win-flash {
            0% { background-color: rgba(76, 175, 80, 0.3); }
            50% { background-color: rgba(76, 175, 80, 0.7); }
            100% { background-color: rgba(76, 175, 80, 0.3); }
        }
        
        .win-animation {
            animation: win-flash 0.5s 3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-btn" id="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="balance" id="user-balance">
                <div>0 ‚≠ê (0 –±–æ–Ω—É—Å)</div>
                <button class="info-btn" id="info-btn">i</button>
            </div>
        </div>
        
        <div class="game-container">
            <div class="slots-machine">
                <div class="slots-display">
                    <div class="slot" id="slot1">
                        <div class="slot-inner">üé∞</div>
                    </div>
                    <div class="slot" id="slot2">
                        <div class="slot-inner">üé∞</div>
                    </div>
                    <div class="slot" id="slot3">
                        <div class="slot-inner">üé∞</div>
                    </div>
                </div>
                <button class="spin-btn" id="spin-btn">–ö—Ä—É—Ç–∏—Ç—å –∑–∞ 5 ‚≠ê</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
            <div class="modal-text" id="confirm-text">–°–ø–∏—Å–∞—Ç—å 5 ‚≠ê –¥–ª—è –∏–≥—Ä—ã –≤ —Å–ª–æ—Ç—ã?</div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-confirm" id="confirm-btn">–î–∞</button>
                <button class="modal-btn modal-btn-cancel" id="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="result-title">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
            <div class="modal-text" id="result-text"></div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-close" id="close-result-btn">–ü–æ–Ω—è—Ç–Ω–æ</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
    <div id="info-modal" class="modal">
        <div class="modal-content info-modal-content">
            <div class="modal-title">–ü—Ä–∞–≤–∏–ª–∞ –∏ –≤—ã–ø–ª–∞—Ç—ã</div>
            
            <div class="info-section">
                <div class="info-title">–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏–∑ 3 —Å–∏–º–≤–æ–ª–æ–≤:</div>
                <div class="payout-item"><span>7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£</span><span>1000 ‚≠ê</span></div>
                <div class="payout-item"><span>üí∞üí∞üí∞</span><span>500 ‚≠ê</span></div>
                <div class="payout-item"><span>üîîüîîüîî</span><span>300 ‚≠ê</span></div>
                <div class="payout-item"><span>‚≠ê‚≠ê‚≠ê</span><span>200 ‚≠ê</span></div>
                <div class="payout-item"><span>üé∞üé∞üé∞</span><span>150 ‚≠ê</span></div>
                <div class="payout-item"><span>üçíüçíüçí</span><span>125 ‚≠ê</span></div>
                <div class="payout-item"><span>üçãüçãüçã</span><span>100 ‚≠ê</span></div>
                <div class="payout-item"><span>üçäüçäüçä</span><span>80 ‚≠ê</span></div>
                <div class="payout-item"><span>üçáüçáüçá</span><span>70 ‚≠ê</span></div>
                <div class="payout-item"><span>üçâüçâüçâ</span><span>60 ‚≠ê</span></div>
                <div class="payout-item"><span>üçéüçéüçé</span><span>50 ‚≠ê</span></div>
                <div class="payout-item"><span>üçìüçìüçì</span><span>50 ‚≠ê</span></div>
            </div>
            
            <div class="info-section">
                <div class="info-title">–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏–∑ 2 —Å–∏–º–≤–æ–ª–æ–≤:</div>
                <div class="payout-item"><span>7Ô∏è‚É£7Ô∏è‚É£</span><span>200 ‚≠ê</span></div>
                <div class="payout-item"><span>üí∞üí∞</span><span>40 ‚≠ê</span></div>
                <div class="payout-item"><span>üîîüîî</span><span>30 ‚≠ê</span></div>
                <div class="payout-item"><span>‚≠ê‚≠ê</span><span>15 ‚≠ê</span></div>
            </div>
            
            <div class="info-section">
                <div class="info-title">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</div>
                <div>–ü—Ä–∏ –∏–≥—Ä–µ –∑–∞ –±–æ–Ω—É—Å–Ω—ã–π –±–∞–ª–∞–Ω—Å –≤—ã–ø–ª–∞—Ç—ã —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç 50% –æ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã—Ö</div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-close" id="close-info-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCMos6Y7C-krTLuKCI4VJG-TFLo6QI--k8",
            authDomain: "vrot-x-7a48f.firebaseapp.com",
            databaseURL: "https://vrot-x-7a48f-default-rtdb.firebaseio.com",
            projectId: "vrot-x-7a48f",
            storageBucket: "vrot-x-7a48f.appspot.com",
            messagingSenderId: "622297225288",
            appId: "1:622297225288:web:5df6a5b02ffddedd96e07d"
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let currentUserId = null;
        let currentBalance = 0;
        let currentBonusBalance = 0;
        let useBonus = false;
        let isSpinning = false;
        const STAKE_AMOUNT = 5;
        
        // –°–∏–º–≤–æ–ª—ã –¥–ª—è —Å–ª–æ—Ç–æ–≤
        const SYMBOLS = ['üçí', 'üçã', 'üçä', 'üçá', 'üçâ', 'üçé', 'üçì', '7Ô∏è‚É£', 'üí∞', 'üîî', '‚≠ê', 'üé∞'];
        
        // –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏ –≤—ã–ø–ª–∞—Ç—ã
        const PAYOUTS = {
            '7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£': 1000,
            'üí∞üí∞üí∞': 500,
            'üîîüîîüîî': 300,
            '‚≠ê‚≠ê‚≠ê': 200,
            'üé∞üé∞üé∞': 150,
            'üçíüçíüçí': 125,
            'üçãüçãüçã': 100,
            'üçäüçäüçä': 80,
            'üçáüçáüçá': 70,
            'üçâüçâüçâ': 60,
            'üçéüçéüçé': 50,
            'üçìüçìüçì': 50,
            '7Ô∏è‚É£7Ô∏è‚É£': 200,
            'üí∞üí∞': 40,
            'üîîüîî': 30,
            '‚≠ê‚≠ê': 15
        };
        
        function getUserId() {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');
            if (!userId) {
                console.error('User ID not found in URL');
                return null;
            }
            return userId;
        }
        
        async function loadUserData(userId) {
            try {
                const userRef = database.ref('users/' + userId);
                const snapshot = await userRef.once('value');
                if (!snapshot.exists()) {
                    console.error('User data not found in database');
                    return null;
                }
                return snapshot.val();
            } catch (error) {
                console.error('Error loading user data:', error);
                return null;
            }
        }
        
        async function updateBalance(userId, amount, isBonus = false) {
            try {
                const userRef = database.ref('users/' + userId);
                const updates = {};
                
                if (isBonus) {
                    updates['bonus_balance'] = currentBonusBalance + amount;
                } else {
                    updates['balance'] = currentBalance + amount;
                }
                
                await userRef.update(updates);
                
                // –ó–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
                const historyRef = database.ref('history/' + userId);
                await historyRef.push().set({
                    type: isBonus ? 'slots_bonus' : 'slots',
                    amount: amount >= 0 ? `+${amount}` : `${amount}`,
                    description: `–ò–≥—Ä–∞ –≤ —Å–ª–æ—Ç—ã: ${amount >= 0 ? '–≤—ã–∏–≥—Ä—ã—à' : '—Å—Ç–∞–≤–∫–∞'}`,
                    date: new Date().toLocaleString('ru-RU'),
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                
                return true;
            } catch (error) {
                console.error('Error updating balance:', error);
                return false;
            }
        }
        
        function showResult(title, message) {
            document.getElementById('result-title').textContent = title;
            document.getElementById('result-text').textContent = message;
            document.getElementById('result-modal').style.display = 'flex';
        }
        
        function spinSlot(slotElement) {
            return new Promise(resolve => {
                let spins = 0;
                const maxSpins = 5 + Math.floor(Math.random() * 5);
                const spinInterval = setInterval(() => {
                    const randomSymbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                    slotElement.querySelector('.slot-inner').textContent = randomSymbol;
                    spins++;
                    
                    if (spins >= maxSpins) {
                        clearInterval(spinInterval);
                        resolve();
                    }
                }, 80);
            });
        }
        
        function checkWin(symbols) {
            const [s1, s2, s3] = symbols;
            let winAmount = 0;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏–∑ 3 —Å–∏–º–≤–æ–ª–æ–≤
            if (s1 === s2 && s2 === s3) {
                const combo = `${s1}${s2}${s3}`;
                winAmount = PAYOUTS[combo] || 0;
            } 
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∏–∑ 2 —Å–∏–º–≤–æ–ª–æ–≤
            else if (s1 === s2 || s2 === s3 || s1 === s3) {
                const combo = s1 === s2 ? `${s1}${s2}` : `${s2}${s3}`;
                winAmount = PAYOUTS[combo] || 0;
            }
            
            return winAmount * (useBonus ? 0.5 : 1);
        }
        
        function updateBalanceDisplay() {
            document.getElementById('user-balance').innerHTML = `
                <div>${currentBalance} ‚≠ê (${currentBonusBalance} –±–æ–Ω—É—Å)</div>
                <button class="info-btn" id="info-btn">i</button>
            `;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –∏–≥—Ä—ã
            const canPlay = (currentBonusBalance >= STAKE_AMOUNT) || 
                          (currentBalance >= STAKE_AMOUNT);
            document.getElementById('spin-btn').disabled = !canPlay || isSpinning;
        }
        
        async function initApp() {
            currentUserId = getUserId();
            
            if (!currentUserId) {
                showResult('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.');
                return;
            }
            
            try {
                const userData = await loadUserData(currentUserId);
                if (!userData) {
                    showResult('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                    return;
                }
                
                currentBalance = userData.balance || 0;
                currentBonusBalance = userData.bonus_balance || 0;
                
                updateBalanceDisplay();
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                document.getElementById('back-btn').addEventListener('click', () => {
                    window.location.href = `index1.html?user_id=${currentUserId}`;
                });
                
                document.getElementById('spin-btn').addEventListener('click', () => {
                    useBonus = currentBonusBalance >= STAKE_AMOUNT;
                    const text = useBonus 
                        ? `–°–ø–∏—Å–∞—Ç—å 5 –±–æ–Ω—É—Å–Ω—ã—Ö ‚≠ê –¥–ª—è –∏–≥—Ä—ã –≤ —Å–ª–æ—Ç—ã? –í—ã–ø–ª–∞—Ç—ã –±—É–¥—É—Ç 50% –æ—Ç –æ–±—ã—á–Ω—ã—Ö.`
                        : `–°–ø–∏—Å–∞—Ç—å 5 ‚≠ê –¥–ª—è –∏–≥—Ä—ã –≤ —Å–ª–æ—Ç—ã?`;
                    document.getElementById('confirm-text').textContent = text;
                    document.getElementById('confirm-modal').style.display = 'flex';
                });
                
                document.getElementById('confirm-btn').addEventListener('click', async () => {
                    document.getElementById('confirm-modal').style.display = 'none';
                    await startSpin();
                });
                
                document.getElementById('cancel-btn').addEventListener('click', () => {
                    document.getElementById('confirm-modal').style.display = 'none';
                    updateBalanceDisplay();
                });
                
                document.getElementById('close-result-btn').addEventListener('click', () => {
                    document.getElementById('result-modal').style.display = 'none';
                    updateBalanceDisplay();
                });
                
                document.getElementById('info-btn').addEventListener('click', () => {
                    document.getElementById('info-modal').style.display = 'flex';
                });
                
                document.getElementById('close-info-btn').addEventListener('click', () => {
                    document.getElementById('info-modal').style.display = 'none';
                });
                
                console.log('App initialized successfully');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showResult('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        }
        
        async function startSpin() {
            if (isSpinning) return;
            isSpinning = true;
            
            const spinBtn = document.getElementById('spin-btn');
            spinBtn.disabled = true;
            updateBalanceDisplay();
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
            const amountToDeduct = STAKE_AMOUNT;
            let deductionSuccess = false;
            
            if (useBonus) {
                if (currentBonusBalance >= amountToDeduct) {
                    currentBonusBalance -= amountToDeduct;
                    deductionSuccess = await updateBalance(currentUserId, -amountToDeduct, true);
                }
            } else {
                if (currentBalance >= amountToDeduct) {
                    currentBalance -= amountToDeduct;
                    deductionSuccess = await updateBalance(currentUserId, -amountToDeduct, false);
                }
            }
            
            if (!deductionSuccess) {
                showResult('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–ø–∏—Å–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                isSpinning = false;
                updateBalanceDisplay();
                return;
            }
            
            updateBalanceDisplay();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
            const slot1 = document.getElementById('slot1');
            const slot2 = document.getElementById('slot2');
            const slot3 = document.getElementById('slot3');
            
            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–ª–æ—Ç–æ–≤ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –º–µ–∂–¥—É –Ω–∏–º–∏
                await Promise.all([
                    spinSlot(slot1),
                    new Promise(resolve => setTimeout(() => spinSlot(slot2).then(resolve), 150)),
                    new Promise(resolve => setTimeout(() => spinSlot(slot3).then(resolve), 300))
                ]);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                const symbols = [
                    slot1.querySelector('.slot-inner').textContent,
                    slot2.querySelector('.slot-inner').textContent,
                    slot3.querySelector('.slot-inner').textContent
                ];
                
                const winAmount = checkWin(symbols);
                
                if (winAmount > 0) {
                    // –ó–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
                    currentBalance += winAmount;
                    const updateSuccess = await updateBalance(currentUserId, winAmount, false);
                    
                    if (updateSuccess) {
                        showResult('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!', `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winAmount} ‚≠ê!`);
                    } else {
                        showResult('–û—à–∏–±–∫–∞', '–í—ã–∏–≥—Ä—ã—à –∑–∞—á–∏—Å–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.');
                    }
                } else {
                    showResult('–†–µ–∑—É–ª—å—Ç–∞—Ç', '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –≤—Ä–∞—â–µ–Ω–∏—è:', error);
                showResult('–û—à–∏–±–∫–∞', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            } finally {
                isSpinning = false;
                updateBalanceDisplay();
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
